<cfinclude template = "../cf_includes/cf_PRE_template_include.htm">
<cfparam name = "display_mode" default = "">

<!--- set form and list files --->
<cfset form_name="data_issue_report.htm">
<cfset list_file="data_issue_report.htm">

<!--- page title --->
<cfset page_title="Data Issue Report">
<cfsavecontent variable="page_description">

</cfsavecontent>

<!--- page header --->
<cfinclude template = "../templates/header.htm">


<!--- WGG 5/27/2014 this is if you are passing in variables
		everything which is being chosen on the report like
		dates or broker id --->
<cfset default_query_name = "">
<cfset default_variables = "
member_id
k_data_source
k_ticket_status
date_from
date_to
pri_from
pri_to
comp_from
comp_to
ticket_from
ticket_to
">
<!--- WGG 5/27/2014 the below line makes the cfset default_variables work --->
<cfinclude template="../cf_includes/set_defaults.htm">

	<cfquery name="q_data_issues" datasource="#application.sys_ds#">
	SELECT issue.pk_TAG_data_issues
	      ,issue.cid
	      ,issue.k_tag_issue_type
		  ,itype.issue_type_name
	      ,issue.k_tag_issue_reason
		  ,ireason.issue_reason_name
		  ,issue.is_ignored
	      ,CASE issue.is_ignored
	      	WHEN 0 THEN 'Not Ignored'
	      	WHEN 1 THEN 'Ignored'
	      	END
	      	AS is_ignored_word
	      ,issue.date_opened
	      ,issue.date_closed
	      ,issue.date_ignored
	      ,issue.is_resolved
	      ,issue.date_resolved
	      ,issue.k_brk_broker
	      ,issue.k_mem_member_master
		  ,m.member_id
	      ,issue.k_mem_membership_window
	      ,issue.k_brk_entity_contract
	      ,b.broker_id
	      ,b.name AS broker_name
	      ,c.name
	  FROM dbo.TAG_data_issues issue
		LEFT JOIN TAG_issue_type itype
			on issue.k_TAG_issue_type = itype.pk_TAG_issue_type
		LEFT JOIN TAG_issue_reason ireason
			on issue.k_TAG_issue_reason = ireason.pk_TAG_issue_reason
		LEFT JOIN mem_member_master m
			on issue.k_mem_member_master = m.pk_mem_member_master
		LEFT JOIN brk_broker b
			on issue.k_brk_broker = b.pk_brk_broker
		LEFT JOIN brk_entity_contract c
			on issue.k_brk_entity_contract = c.pk_brk_entity_contract
			
	</cfquery>

		
	
<script>

function Status_Submitted() {
	$("#k_ticket_status").val(0);
}

function reorder(x,y,z){
	//alert(x+y+z);
	
  $.ajax({
           type: "POST",
           url: "ticket_reorder.cfm",
           data: { kID: y, pID: x, clientid: z},
           success: function(){
   				location.reload(); 
  			}
        })
    }
    
function OpenComplete() {
	//alert('test');
	  $.ajax({
           type: "POST",
           url: "ticket_complete.htm",
           data: { clientid: 3},
           success: function(data){
   				$('#complete_win').html(data);
  			}
        })
    }


function HideComplete() {
	$("#CompleteDiv").hide();
}

</script>

<form>

	<div style="border-style:solid; border-width: 1px; border-radius:15px; width:1500; 
				margin: 0 auto 0 auto; padding: 10px; background:#FFFFFF;">
		<div align="center">
		<span><b>Data Issues</b></span>
		<table id="cpy" class="list_table scrolling" scroll_height="1500" width="1450">
			<thead>
			<tr class="list_col_hdr">
				<td width="50" align="center">Issue Type</td>
				<td width="60" align="center">Reason</td>
				<td width="60" align="center">Ignored</td>		
				<td width="60" align="center">Ignored 2</td>
				<td width="60" align="center">Date Opened</td>
				<td width="60" align="center">Date Closed</td>
				<td width="30" align="center">Date Ignored</td>
				<td width="60" align="center">Rep ID</td>
				<td width="60" align="center">Rep Name</td>
				<td width="60" align="center">Contract ID</td>
				<td width="60" align="center">Contract Name</td>
				<td width="60" align="center">Member ID</td>
			</tr>
			</thead>
			<cfset toggle = 1>
			<cfoutput query = "q_data_issues">
			<cfif toggle gt 0><cfset even_odd = "even"><cfelse><cfset even_odd = "odd"></cfif><cfset toggle = toggle*-1>
			<tr class="list_even_odd">
				<td width="50" align="center">#issue_type_name#</td>
				<td width="60" align="center">#issue_reason_name#</td>
				<td width="60" align="center">#is_ignored_word#</td>
				<td width="60" align="center" >
					<select name="is_ignored_box" id="is_ignored_box">
					<option value="0" <cfif is_ignored eq '0'>Selected="selected"</cfif>>Not Ignored</option>
					<option value="1" <cfif is_ignored eq '1'>Selected="selected"</cfif>>Ignored</option>	
				</td>
				<td width="60" align="center">#date_opened#</td>
				<td width="60" align="center">#date_closed#</td>
				<td width="30" align="center">#date_ignored#</td>
				<td width="60" align="center">#broker_id#</td>
				<td width="60" align="center">#broker_name#</td>				
				<td width="60" align="center">#k_brk_entity_contract#</td>
				<td width="60" align="center">#name#</td>
				<td width="60" align="center">#member_id#</td>
			</tr>
			</cfoutput>		
		</table>
		</div>
	</div>
	<br>
</form>

<cfset ajaxonload("doScrollTables")>
<cfset ajaxonload("makeSortable")>


