<cfinclude template = "../cf_includes/cf_PRE_template_include.htm">
<cfparam name = "display_mode" default = "">

<!--- set form and list files --->
<cfset form_name="list_ticket_report.htm">
<cfset list_file="list_ticket_report.htm">

<!--- page title --->
<cfset page_title="Ticket Report">
<cfsavecontent variable="page_description">

</cfsavecontent>

<!--- page header --->
<cfinclude template = "../templates/header.htm">


<!--- set defaults for brk_sales_activity_log --->
<cfset default_query_name = "">
<cfset default_variables = "
hours_worked
k_data_source
pk_ticket
">
<cfinclude template="../cf_includes/set_defaults.htm">
<!--- END set defaults for brk_sales_activity_log --->

<cfif k_data_source EQ ''>
	<cfset k_data_source = 3>
</cfif>


	<div style="float:left">
	<cfquery name="total_hours_by_client" datasource="#application.ticket_ds#">
		SELECT 
			 t.cid AS client_cid
			 ,client_name = 
				 CASE t.cid
					WHEN 2 THEN 'CDPHP'
					WHEN 3 THEN 'HCA'
					WHEN 4 THEN 'CIGNA'
					WHEN 5 THEN 'SCAN'
					WHEN 7 THEN 'MOLINA MAPD'
					WHEN 14 THEN 'MOLINA MP'
					WHEN 15 THEN 'SOUNDPATH'
					ELSE 'Unknown'
				END
			,sum(ttt.time_tracked) AS hours_worked
		FROM ticket_time_tracking ttt
			INNER JOIN ticket t ON t.pk_ticket = ttt.k_ticket
		WHERE ttt.date_tracked BETWEEN '01-01-2012' AND '12-31-2014' -- date variables here
		GROUP BY t.cid
	</cfquery>
	<h2>Hours by Client</h2>
	<!--- 
	<table style="border-width:1px; border-style:solid;">
	--->
	<table id="hours_by_client_tbl" class="list_table scrolling" scroll_height="1500" width=98%>
		<tr class="list_col_hdr">
				<td><b>Client</b></td>
				<td><b>Hours</b></td>		
		</tr>
		<cfloop query = "total_hours_by_client"> 
			 <tr class="list_col_hdr">
				<td><cfoutput>#client_name#</cfoutput></td><!--- this was originally #cid# and it only showed 4 because it was pulling it from another query --->
				<td><cfoutput>#Hours_worked#</cfoutput></td>
			</tr>
		</cfloop>
	</table>

	</div>

		
